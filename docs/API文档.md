# Pokédex AI 智能图鉴系统 - API文档

## 文档更新说明

本文档详细描述了Pokédex AI智能图鉴系统当前的API接口，明确标注了当前支持的功能范围和限制，并说明了后续计划实现的功能。

> **重要提示**：当前版本（v1.0）仅支持宝可梦特性和种族值的查询功能，进化链及其他相关服务暂未在问答逻辑中实现，计划在后续版本中更新。

## API概览

### 基础URL

当前API基础URL为：`http://localhost:8000`

### 可用端点

| 端点 | 方法 | 描述 | 支持状态 |
|------|------|------|----------|
| `/health` | `GET` | 健康检查 | ✅ 已实现 |
| `/ask` | `POST` | 宝可梦图鉴问答 | ✅ 已实现（限制功能） |
| 进化链相关接口 | 未实现 | 获取宝可梦进化链信息 | ⏱️ 计划中 |

## 详细接口文档

### 1. 健康检查接口

#### `GET /health`

**描述**：检查服务健康状态

**响应**：
```json
{
  "status": "healthy",
  "timestamp": "2025-11-14T12:00:00Z"
}
```

### 2. 宝可梦图鉴问答接口

#### `POST /ask`

**描述**：通过自然语言提问宝可梦相关问题，系统会返回基于PokeAPI数据的AI生成答案。

> **功能限制说明**：当前版本仅支持查询宝可梦的基本信息、特性和种族值相关问题。虽然系统能够从PokeAPI获取进化链数据，但在问答处理流程中暂未集成使用。

**请求体**：
```json
{
  "question": "喷火龙的属性和种族值？"
}
```

**响应**：
```json
{
  "answer": "喷火龙是火/飞行属性，种族值总和534...",
  "pokemon_name": "charizard",
  "pokemon_id": 6,
  "intent": {
      "pokemon_name": "charizard",
      "original_name": "喷火龙",
      "intent_type": "basic_info",
      "detail_level": "normal"
  }
}
```

**请求参数说明**：
- `question`：用户的自然语言问题，支持关于宝可梦特性和种族值的查询。

**响应参数说明**：
- `answer`：系统生成的自然语言回答
- `pokemon_name`：识别出的宝可梦英文名称
- `pokemon_id`：宝可梦的ID
- `intent`：解析出的用户意图信息
  - `pokemon_name`：识别出的宝可梦英文名称
  - `original_name`：用户问题中提到的宝可梦名称
  - `intent_type`：意图类型（如basic_info、stats等）
  - `detail_level`：详细程度（low/normal/high）

**示例问题**：
- 支持的问题类型：
  - "皮卡丘的种族值是多少？"
  - "妙蛙种子有什么特性？"
  - "超梦的属性是什么？"
- 功能限制示例：
  - 关于进化链的问题（如"小火龙如何进化？"）可能返回有限信息，因为当前问答逻辑未完全集成进化链数据

## 当前功能实现详情

### 已实现功能

1. **宝可梦基础信息查询**
   - 获取宝可梦的名称、ID、属性、身高、体重等基础数据
   - 支持从数据库缓存或PokeAPI获取数据

2. **宝可梦特性和种族值查询**
   - 获取宝可梦的基础特性和隐藏特性
   - 获取宝可梦的六项种族值（HP、攻击、防御、特攻、特防、速度）

3. **用户意图识别**
   - 基于豆包AI模型解析用户问题意图
   - 识别问题中的宝可梦名称

4. **自然语言问答生成**
   - 基于获取的宝可梦数据生成自然语言回答
   - 回答格式优化，提供简洁准确的信息

### 未实现功能（计划中）

1. **进化链完整支持**
   - 虽然系统已实现从PokeAPI获取进化链数据的方法，但尚未在问答逻辑中集成使用
   - 计划在v1.1版本中完全支持进化链相关问题

2. **技能学习信息**
   - 当前仅获取部分技能数据，但未在问答中充分利用
   - 计划在v1.2版本中增强技能相关查询功能

3. **属性相克关系**
   - 尚未实现属性相克计算和查询功能
   - 计划在v1.3版本中添加

4. **多语言支持**
   - 当前主要支持中文问答
   - 计划在后续版本中增加多语言支持

## 技术实现说明

### 数据流程

1. 用户发送问题到`/ask`接口
2. 系统使用豆包模型解析问题意图，提取宝可梦名称
3. 系统从数据库缓存或PokeAPI获取宝可梦基础数据和物种数据
4. 系统将数据和问题发送给豆包模型生成自然语言回答
5. 返回回答和相关信息给用户

### 数据来源

- 宝可梦基础数据：从PokeAPI的`/pokemon/{name}`端点获取
- 宝可梦物种数据：从PokeAPI的`/pokemon-species/{name}`端点获取
- 进化链数据：从PokeAPI的`/evolution-chain/{id}`端点获取（当前未完全集成到问答逻辑）

## 后续版本规划

### v1.1版本（计划中）

- 完善进化链相关功能，支持进化路径和条件查询
- 优化问答质量，提供更准确的进化信息

### v1.2版本（计划中）

- 增强技能学习信息查询功能
- 添加更多宝可梦数据维度，如捕获率、蛋组等

### v1.3版本（计划中）

- 实现属性相克关系计算和查询
- 添加配招建议功能

## 错误处理

### 常见错误响应

| 状态码 | 错误信息 | 说明 |
|--------|----------|------|
| 404 | "Pokemon not found" | 请求的宝可梦不存在 |
| 500 | "处理请求时发生错误" | 服务器内部错误 |
| 503 | "无法连接到豆包服务器" | 外部服务连接失败 |

## API测试

可以通过以下方式测试API：

1. **使用Swagger UI**：访问`http://localhost:8000/docs`
2. **使用ReDoc**：访问`http://localhost:8000/redoc`
3. **使用curl命令**：
   ```bash
   curl -X POST -H "Content-Type: application/json" -d '{"question": "皮卡丘的特性是什么？"}' http://localhost:8000/ask
   ```

## 注意事项

1. API请求可能受到PokeAPI和豆包API的速率限制
2. 首次查询新宝可梦时，由于需要从PokeAPI获取数据，响应时间可能较长
3. 涉及进化链等未完全实现功能的问题，可能无法获得完整回答

---

**文档版本**：v1.0
**更新日期**：2025.11.14