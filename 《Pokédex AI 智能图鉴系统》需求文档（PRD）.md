# 《Pokédex AI 智能图鉴系统》需求文档（PRD）

- 文档版本：v1.0
- 作者：sorenzhang
- 日期：*2025.11.14*
- 目标环境：Trae + Doubao Seed Code（Python / FastAPI 模板）

------

## 1. 项目背景（Background）

宝可梦玩家在查询资料时，常需要在多个网站或图鉴中来回切换，信息分散、形式不统一，且传统图鉴不支持自然语言问答：

- 用户只能按精灵名 / 编号检索，难以用口语问题（例如“喷火龙强不强？”、“小火龙怎么进化”）直接得到答案。
- 对战入门玩家对“种族值、属性克制、特性、技能”等信息理解成本高，希望有人能用「人话」解释。

本项目希望在 **Trae + 豆包（Doubao）** 环境下，基于 **PokeAPI + MySQL 缓存**，实现一个“**会说话的宝可梦图鉴**”，先从 **图鉴问答 MVP** 做起，为后续扩展属性相克、配招、队伍推荐打基础。

------

## 2. 项目目标（Goals）

### 2.1 总体目标

构建一个部署在 Trae 环境中的后端服务，结合豆包大模型，实现：

- 支持用户用自然语言（中文为主）询问宝可梦相关问题；
- 系统能从 PokeAPI 获取准确数据，并用 AI 组织易懂的中文回答；
- 提供一个清晰、可复用的项目骨架，方便未来继续扩展功能。

### 2.2 可量化目标（MVP）

- 覆盖 **全部国服常见宝可梦**（数据来源为 PokeAPI，缓存于 MySQL）。
- 对以下类型问题，命中率 ≥ 90%：
  - “X 的属性 / 种族值是什么？”
  - “X 有哪些特性？”
  - “X 怎么进化？”
  - “简单介绍一下 X。”
- 一般查询响应时间（API → AI 回答）在 **2 秒内**（不考虑首次冷缓存和外部网络异常）。
- 代码基于 **Doubao seed code** 模板，结构清晰，可在 Trae 中一键运行。

------

## 3. 用户与使用场景（Users & Scenarios）

### 3.1 用户画像

1. **普通宝可梦玩家**
   - 想快速查阅某只宝可梦的基本资料。
   - 偶尔会问一些模糊问题或口语化问题。
2. **对战 / 排位玩家**
   - 更关心种族值、属性、特性等硬数据。
   - 希望知道宝可梦的大致定位与优劣势。
3. **宝可梦内容创作者 / 开发者**
   - 在做攻略、工具、小程序，需要一个“问就有数据”的后端服务。
   - 可能会在后续将本服务与自己的前端绑定。

### 3.2 使用场景示例

1. **快速查询图鉴**
   - 用户输入：“喷火龙的属性和种族值是什么？”
   - 系统输出：简要回答（火 / 飞行，基础种族值表）+ 一些简单解读。
2. **进化问题**
   - 用户输入：“小火龙怎么进化？”
   - 系统输出：按等级顺序给出进化链，并简要说明。
3. **信息综合介绍**
   - 用户输入：“帮我简单介绍一下甲贺忍蛙。”
   - 系统输出：属性、种族值概览、特性、简单图鉴说明。
4. **模糊表达**
   - 用户输入：“杰尼龟强吗？”
   - 系统输出：先识别宝可梦，再基于数据给出中立评价（体型、种族值特点、适用场景）。

------

## 4. 功能需求（Functional Requirements）

### 4.1 MVP 核心功能

#### 4.1.1 图鉴问答（Dex Q&A）

**描述**
 用户通过自然语言提出与“单只宝可梦”相关的问题，系统返回基于 PokeAPI 数据的 AI 生成答案。

**输入示例：**

- “喷火龙的属性和种族值？”
- “皮卡丘有什么特性？”
- “妙蛙花能学什么属性的招式？”
- “给我介绍一下烈咬陆鲨。”

**系统行为：**

1. 接收用户问题（接口 `/ask`）。
2. 调用豆包（解析模式），将用户问题转为结构化意图，包括但不限于：
   - `pokemon_name`：英文名（小写），如 `charizard`；
   - `original_name`：用户原始称呼；
   - `intent_type`：如 `basic_info` / `stats` / `evolution` / `intro` 等（可选）；
   - `detail_level`：`low` / `normal` / `high`。
3. 若未能解析出宝可梦：
   - 返回：“我没太确定你说的是哪只宝可梦，可以再具体一点吗？”。
4. 若解析成功：
   - 查询 MySQL 缓存：
     - 若有 `/pokemon/{name}`，直接使用；
     - 若没有，调用 PokeAPI 拉取数据并写入 MySQL。
   - 同理处理 `/pokemon-species/{name}`。
5. 将结构化数据（pokemon / species JSON）与原问题一起传给豆包（回答模式）。
6. 豆包生成一段结构化良好的中文回答，返回给前端。

**输出示例（逻辑，不要求固定格式）：**

- 先一句整体概括；
- 然后分点说明：
  - 属性；
  - 种族值；
  - 特性；
  - 简单图鉴介绍；
  - 若问题涉及进化，则附上进化信息。

------

#### 4.1.2 PokeAPI 数据获取与缓存（Data Fetch & Cache）

**描述**
 通过 PokeAPI 拉取宝可梦基础数据，在 MySQL 中进行 JSON 缓存，避免重复请求外部 API。

**需求点：**

1. 支持从 PokeAPI 拉取：
   - `/pokemon/{id or name}`
   - `/pokemon-species/{id or name}`
2. 查询策略：
   - 优先从 MySQL 缓存中读取；
   - 若不存在，则调用 PokeAPI，并将返回 JSON 原样存入 MySQL。
3. 对 PokeAPI 请求进行基本错误处理：
   - 404：提示“未找到该宝可梦”；
   - 网络错误 / 超时：返回“目前无法获取图鉴数据，请稍后再试”。

------

#### 4.1.3 错误处理与兜底（Graceful Fallback）

**需求点：**

1. **宝可梦名称识别失败：**

   - 豆包未能解析出 `pokemon_name` 时，接口返回通用提示，避免报错堆栈。

2. **PokeAPI 调用失败：**

   - 超时、网络错误时，返回“图鉴数据暂时无法获取”的友好提示。

3. **豆包调用失败：**

   - 返回一个简短的兜底回答，例如：

     > “现在 AI 生成部分出现了一点问题，但我已经拿到了部分图鉴数据，你可以稍后再试或换个问题。”

------

### 4.2 后续迭代功能（Non-MVP）

> 以下不在本次 MVP 开发范围，只在 PRD 中预留描述。

1. **属性相克问答**
   - 问题示例：“钢对妖精怎么样？”、“火系怕什么？”
   - 基于 `/type` 接口 + 规则逻辑。
2. **配招建议**
   - 针对某只宝可梦列出代表性技能搭配（需要引入对战环境数据或规则）。
3. **队伍推荐**
   - 以某精灵为核心，推荐搭档队友（需要更多对战数据与逻辑）。
4. **多语言支持**
   - 英文 / 日文问答；
   - name 多语言映射（中日英）。
5. **前端 Web UI**
   - 基于 REST API 开发一个简单可视化图鉴页面。

------

## 5. 交互与流程设计（Interaction & Flows）

### 5.1 核心交互流程：图鉴问答

**文字流程图：**

1. 用户：在前端或 Postman 调用 `/ask`，传入 JSON：
   - `{"question": "喷火龙的属性和种族值？"}`
2. 后端（FastAPI in Trae）：
   1. 接收请求，记录日志（问题原文）。
   2. 调用豆包（解析意图）：
      - 输入：问题文本；
      - 输出：`{"pokemon_name": "charizard", "original_name": "喷火龙", ...}`。
   3. 若 `pokemon_name` 为空：
      - 直接返回兜底提示。
   4. 若 `pokemon_name` 不为空：
      - 打开 MySQL 连接：
        - 查询 `pokemon` 表是否存在对应记录；
        - 若不存在 → 调用 PokeAPI 并写入；
      - 同样处理 `pokemon_species`。
   5. 构造一个上下文 JSON，包含：
      - 用户原始问题；
      - pokemon JSON；
      - pokemon_species JSON。
   6. 调用豆包（生成回答模式）：
      - 输入：系统提示 + 上下文 JSON；
      - 输出：中文自然语言答案。
   7. 将答案封装为响应 JSON，返回给调用方。
3. 用户：在前端看到回答文本。

------

## 6. 技术与架构需求（Tech Requirements）

### 6.1 技术栈与运行环境

- 开发环境：
  - Trae（使用 Doubao Seed Code 模板）
- 后端语言框架：
  - Python 3.x
  - FastAPI
- 数据库：
  - MySQL（UTF8MB4）
  - 使用 SQLAlchemy / ORM
- 外部服务：
  - 豆包（Doubao）大模型 API
  - PokeAPI（[https://pokeapi.co）](https://pokeapi.co)/)
- 依赖库（示例）：
  - `fastapi`
  - `uvicorn`
  - `requests` 或 `httpx`
  - `sqlalchemy`
  - `mysql-connector-python` 或 `pymysql`
  - 豆包官方 SDK（按 Trae / doubao seed code 默认）

### 6.2 系统架构（高层）

模块划分建议：

1. **API 层**
   - `/ask` 图鉴问答接口
   - 后续可扩展 `/pokemon/{name}` 结构化数据接口
2. **业务层（Service）**
   - `qa_service`：图鉴问答流程编排（调用解析 → 数据获取 → 回答生成）
   - `pokemon_service`：封装宝可梦数据获取与处理逻辑
3. **数据访问层（DAO / Repository）**
   - `pokeapi_client`：与 PokeAPI 的 HTTP 通信
   - `pokemon_repository`：MySQL 读写缓存
4. **AI 接入层**
   - `doubao_client`：
     - `parse_question_to_intent()`
     - `build_answer_with_doubao()`
5. **基础设施**
   - DB 连接管理
   - 日志记录
   - 配置管理（环境变量 / Trae 配置）

------

## 6.3 数据库设计（MVP 版本）

**pokemon 表（缓存 /pokemon）**

- `id`：INT，主键，对应 PokeAPI `id`
- `name`：VARCHAR(64)，唯一，小写英文名，例如 `charizard`
- `data`：JSON，完整存储 `/pokemon` 的返回
- `updated_at`：DATETIME，自动更新时间

**pokemon_species 表（缓存 /pokemon-species）**

- `id`：INT，主键，对应 PokeAPI `id`
- `name`：VARCHAR(64)，唯一，小写英文名
- `data`：JSON，完整存储 `/pokemon-species`
- `updated_at`：DATETIME，自动更新时间

> 说明：
>  MVP 阶段不拆字段，以 JSON 缓存为主；后续如有复杂查询再分解为规范化表。

------

## 7. 非功能需求（Non-Functional Requirements）

### 7.1 性能

- 单次常规查询在 2 秒内完成（包含 AI 调用），不计入网络异常。
- 对同一宝可梦的数据请求应命中本地 MySQL，不重复访问 PokeAPI。

### 7.2 可用性 & 容错

- 对外部 PokeAPI 与豆包 API 做超时设置与错误处理；
- 当外部服务不可用时，给用户清晰的错误提示，而不是报栈。

### 7.3 可维护性

- 代码结构与 Doubao seed code 保持一致：
  - 清晰的模块分层；
  - 注释和 README 说明关键流程；
- 便于在 Trae 中继续扩展其他接口与功能。

### 7.4 安全性

- 不涉及敏感用户数据；
- 外部 API Key 使用环境变量或 Trae 提供的安全配置，不硬编码在仓库中。

------

## 8. 风险与限制（Risks & Constraints）

1. **PokeAPI 限流 / 不稳定**
   - 解决：本地缓存 + 适当重试 / 回退提示。
2. **豆包解析名字失败**
   - 解决：提示用户明确精灵名；后续可引入自建 alias 表优化。
3. **多语言 / 多版本差异**
   - MVP 暂不处理不同世代数据差异，只依据当前 PokeAPI 返回；
   - 后续可在技术方案中增加世代字段。
4. **Trae / Doubao 环境约束**
   - 需要遵守 seed code 项目结构；
   - 依赖版本应与 Trae 默认环境兼容。

------

## 9. 交付物（Deliverables）

MVP 阶段交付物包括：

1. 本 PRD 文档（v1.0）
2. 技术方案文档（包含详细架构图、模块说明、接口定义）
3. 基于 Trae + Doubao seed code 的后端工程：
   - 图鉴问答接口 `/ask`
   - PokeAPI + MySQL 缓存实现
   - 豆包解析与回答封装实现
4. 数据库初始化脚本（建表 SQL 或自动迁移脚本）
5. 简单接口调用示例（Postman / curl 示例）

------

## 10. 里程碑规划（Milestones）

> 时间可根据你实际情况改，这里给一个建议节奏。

- **第 1 周**
  - 确认 PRD & 技术方案；
  - 在 Trae 中创建项目，跑通 seed code 基础服务；
  - 建立 MySQL 表结构与基础连接。
- **第 2 周**
  - 完成 PokeAPI + MySQL 缓存模块；
  - 完成豆包解析与回答生成模块；
  - 打通 `/ask` 端到端流程。
- **第 3 周**
  - 补充异常处理 / 日志；
  - 针对典型问题做场景测试；
  - 整理 README 与部署说明。

------

如果你愿意，下一步我可以直接：

- 按 **“技术方案文档”** 的格式，专门为 “Trae + Doubao seed code” 写一份更细的《技术设计说明》（比如具体放在哪个目录、如何在 Trae 里配置豆包、模块命名建议）；
   或者
- 直接给你一套 **基于 seed code 的目录结构 + 拟定文件名 & 模块职责**，方便你打开 Trae 就照着实现。